<div class="control-panel">
  <h3>Control Panel</h3>

  <!-- Layer Control Button -->
  <button class="layer-control-btn-inline" (click)="toggleLayerPanel()" [title]="'Toggle Layers'">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
      <path d="M2 17l10 5 10-5"></path>
      <path d="M2 12l10 5 10-5"></path>
    </svg>
    Active Layers
  </button>

  <!-- Layer Control Panel -->
  <div class="layer-panel" [class.open]="isLayerPanelOpen">
    <div class="layer-panel-header">
      <h4>Select Layers ({{ activeLayerIds.size }}/{{ layerTypes.length || 22 }})</h4>
      <button class="close-btn" (click)="toggleLayerPanel()">×</button>
    </div>
    <div class="layer-panel-content">
      <div class="layer-item" *ngFor="let layer of layerTypes">
        <label class="layer-checkbox">
          <input
            type="checkbox"
            [checked]="isLayerActive(layer.id)"
            (change)="onLayerToggle(layer.id)"
            [disabled]="isLoading">
          <span class="layer-color-indicator" [style.background-color]="getLayerColorStyle(layer.id)"></span>
          <span class="layer-name">{{ layer.name }}</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Basemap Control -->
  <div class="control-group">
    <label for="basemap">Basemap:</label>
    <select id="basemap" [(ngModel)]="selectedBasemap" (change)="onSettingsChange()" [disabled]="isLoading">
      <option *ngFor="let basemap of basemapOptions" [value]="basemap.id">
        {{ basemap.name }}
      </option>
    </select>
  </div>

  <!-- Symbol Type Control -->
  <div class="control-group">
    <label for="symbolType">Symbol Type:</label>
    <select id="symbolType" [(ngModel)]="selectedSymbolType" (change)="onSettingsChange()" [disabled]="isLoading">
      <option value="simple-marker">Simple Marker (Point)</option>
      <option value="circle">Circle</option>
      <option value="square">Square</option>
      <option value="diamond">Diamond</option>
      <option value="cross">Cross</option>
      <option value="x">X Symbol</option>
      <option value="triangle">Triangle</option>
      <option value="picture-marker">Picture Marker (SVG)</option>
      <option value="complex-svg">Complex SVG</option>
    </select>
  </div>

  <!-- Entities Amount Control -->
  <div class="control-group">
    <label for="entitiesAmount">Entities Per Layer:</label>
    <input
      type="number"
      id="entitiesAmount"
      [(ngModel)]="entitiesAmount"
      (change)="onSettingsChange()"
      [disabled]="isLoading"
      min="100"
      max="100000"
      step="100"
      placeholder="Enter number per layer">
    <small class="hint">Per layer: {{ entitiesAmount | number }} entities</small>
    <div class="total-entities">
      <strong>Total Entities:</strong> {{ getTotalEntities() | number }}
    </div>
  </div>

  <!-- Apply Button -->
  <button 
    class="apply-button" 
    (click)="applySettings()" 
    [disabled]="isLoading">
    Apply Settings
  </button>

  <!-- Statistics Section -->
  <div class="stats-info">
    <h4>Statistics:</h4>
    <div class="stat-item">
      <span class="stat-label">Active Layers:</span>
      <span class="stat-value">{{ activeLayerIds.size }} / 22</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Total Entities:</span>
      <span class="stat-value">{{ getActiveEntitiesCount() | number }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Symbol Type:</span>
      <span class="stat-value">{{ getSymbolTypeName() }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Loading Time:</span>
      <span class="stat-value">{{ totalLoadingTime }} ms</span>
    </div>
    <div class="stat-item" *ngIf="lastLoadedTime">
      <span class="stat-label">Loaded At:</span>
      <span class="stat-value">{{ lastLoadedTime }}</span>
    </div>
  </div>

  <!-- History Section -->
  <div class="history-section">
    <div class="history-header" (click)="toggleHistory()">
      <h4>History</h4>
      <span class="history-count" *ngIf="history.length > 0">({{ history.length }})</span>
      <button class="toggle-btn" [class.expanded]="isHistoryExpanded">
        {{ isHistoryExpanded ? '−' : '+' }}
      </button>
    </div>

    <div class="history-content" *ngIf="isHistoryExpanded">
      <div class="history-actions" *ngIf="history.length > 0">
        <button class="clear-history-btn" (click)="clearHistory()">Clear History</button>
      </div>

      <div class="history-empty" *ngIf="history.length === 0">
        <p>No history yet. Apply settings to see history.</p>
      </div>

      <div class="history-table-wrapper" *ngIf="history.length > 0">
        <table class="history-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Basemap</th>
              <th>Symbol</th>
              <th>Entities</th>
              <th>Load Time</th>
              <th>Layers</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let entry of history" class="history-row">
              <td class="timestamp">{{ entry.timestamp | date:'short' }}</td>
              <td>{{ entry.basemap }}</td>
              <td>{{ entry.symbolType }}</td>
              <td>{{ entry.totalEntities | number }}</td>
              <td class="load-time">{{ entry.loadingTime }} ms</td>
              <td>{{ entry.activeLayersCount }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
